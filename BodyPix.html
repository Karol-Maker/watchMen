<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detecção de Pessoas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.0/dist/body-pix.min.js"></script>
  <style> /* isolar */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #1a1a1a; /* Preto de fundo */
      color: white;
    }
    .container {
      max-width: 900px;
      background-color: #2c2c2c; /* Fundo escuro */
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      margin: 50px auto;
    }
    h1 {
      font-size: 2.5rem;
      color: #FFD700; /* Dourado */
      text-align: center;
      margin-bottom: 1.5rem;
    }
    p {
      color: #D3D3D3; /* Texto tons cinza claro */
      text-align: center;
      margin-bottom: 2rem;
    }
    .btn {
      padding: 15px 30px;
      font-size: 1rem;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .btn-primary {
      background-color: #FFD700; /* Dourado */
      color: black;
      border: 2px solid #FFD700;
    }
    .btn-primary:hover {
      background-color: #e6b800;
    }
    .btn-secondary {
      background-color: #333;
      color: white;
      border: 2px solid #333;
    }
    .btn-secondary:hover {
      background-color: #444;
    }
    .progress-container {
      background-color: #444;
      border-radius: 10px;
      height: 8px;
      margin-top: 15px;
      width: 100%;
    }
    .progress-bar {
      background-color: #FFD700;
      height: 100%;
      width: 0%;
      transition: width 0.3s ease;
    }
    .input-file {
      display: none;
    }
    #originalImage {
      max-width: 100%;
      height: auto;
      border-radius: 15px;
      margin-top: 20px;
    }
    canvas {
      max-width: 100%;
      height: auto;
      border-radius: 15px;
      margin-top: 20px;
    }
    .flex-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }
    .flex-col {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 15px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Detecção de Pessoas</h1>
    <p>Selecione uma imagem para análise.</p>

    <div class="flex-col">
      <label class="btn btn-primary">
        Selecione uma imagem
        <input type="file" id="imageInput" class="input-file" accept="image/*">
      </label>

      <div class="w-full max-w-md space-y-4 bg-gray-700 p-4 rounded-lg">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2 text-center">Brilho:</label>
          <div class="flex items-center justify-center gap-3">
            <button id="brightnessMinus" class="btn btn-secondary">−</button>
            <div class="w-20 text-center">
              <div class="h-2 bg-gray-500 rounded-full overflow-hidden">
                <div id="brightnessBar" class="h-full bg-blue-500" style="width: 50%;"></div>
              </div>
            </div>
            <button id="brightnessPlus" class="btn btn-secondary">+</button>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2 text-center">Contraste:</label>
          <div class="flex items-center justify-center gap-3">
            <button id="contrastMinus" class="btn btn-secondary">−</button>
            <div class="w-20 text-center">
              <div class="h-2 bg-gray-500 rounded-full overflow-hidden">
                <div id="contrastBar" class="h-full bg-purple-500" style="width: 50%;"></div>
              </div>
            </div>
            <button id="contrastPlus" class="btn btn-secondary">+</button>
          </div>
        </div>

        <div class="flex gap-2">
          <button id="resetButton" class="btn btn-secondary flex-1">Resetar</button>
          <button id="processButton" class="btn btn-primary flex-1">Processar</button>
        </div>
      </div>

      <div id="status" class="text-lg font-medium text-gray-300">Aguardando imagem...</div>

      <div class="progress-container">
        <div id="progressBar" class="progress-bar"></div>
      </div>

      <div class="flex-row">
        <div class="flex-col">
          <h2 class="text-xl font-semibold mb-2 text-gray-300">Imagem Original</h2>
          <img id="originalImage" style="display:none;" alt="Imagem selecionada">
        </div>
        <div class="flex-col">
          <h2 class="text-xl font-semibold mb-2 text-gray-300">Pessoas Detectadas</h2>
          <canvas id="maskCanvas" style="display:none;" width="600" height="400"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    let net;
    let brightness = 0;
    let contrast = 0;

    // Carrega o modelo BodyPix
    async function loadModel() {
      net = await bodyPix.load();
      document.getElementById('status').innerText = 'Modelo carregado. Pronto para detectar!';
    }

    loadModel();

    // Lida com a imagem selecionada
    document.getElementById('imageInput').addEventListener('change', handleImageUpload);

    async function handleImageUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const img = document.getElementById('originalImage');
        img.src = URL.createObjectURL(file);
        img.style.display = 'block';

        document.getElementById('progressBar').style.width = '50%';
        document.getElementById('status').innerText = 'Detectando pessoas...';

        const image = new Image();
        image.src = URL.createObjectURL(file);

        image.onload = async () => {
          const segmentation = await net.segmentPerson(image);
          document.getElementById('progressBar').style.width = '100%';

          const canvas = document.getElementById('maskCanvas');
          const ctx = canvas.getContext('2d');
          canvas.style.display = 'block';
          ctx.drawImage(image, 0, 0);
          bodyPix.drawMask(canvas, image, segmentation, 1, 0, false);

          document.getElementById('status').innerText = segmentation.allPoses.length > 0 ? 'Pessoa(s) detectada(s)' : 'Nenhuma pessoa detectada';
        };
      }
    }

    // para auxiliar npo brilho
    document.getElementById('brightnessPlus').addEventListener('click', () => {
      brightness += 10;
      if (brightness > 100) brightness = 100;
      document.getElementById('brightnessValue').innerText = brightness;
      document.getElementById('brightnessBar').style.width = `${brightness}%`;
      updateImage();
    });

    document.getElementById('brightnessMinus').addEventListener('click', () => {
      brightness -= 10;
      if (brightness < 0) brightness = 0;
      document.getElementById('brightnessValue').innerText = brightness;
      document.getElementById('brightnessBar').style.width = `${brightness}%`;
      updateImage();
    });

    // Ajuste contrast
    document.getElementById('contrastPlus').addEventListener('click', () => {
      contrast += 10;
      if (contrast > 100) contrast = 100;
      document.getElementById('contrastValue').innerText = contrast;
      document.getElementById('contrastBar').style.width = `${contrast}%`;
      updateImage();
    });

    document.getElementById('contrastMinus').addEventListener('click', () => {
      contrast -= 10;
      if (contrast < 0) contrast = 0;
      document.getElementById('contrastValue').innerText = contrast;
      document.getElementById('contrastBar').style.width = `${contrast}%`;
      updateImage();
    });

    // Atualizaimagerm bri, cont
    function updateImage() {
      const img = document.getElementById('originalImage');
      img.style.filter = `brightness(${brightness}%) contrast(${contrast}%)`;
    }
  </script>
</body>
</html>
